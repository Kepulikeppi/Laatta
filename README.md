# Laatta

A browser-based multiplayer block world game with voice chat.

## Features

- **Procedural World Generation**: Smooth terrain using Perlin noise with multiple octaves
- **Multiplayer**: Real-time player movement synced via WebSockets
- **Voice Chat**: WebRTC-based voice communication with push-to-talk or always-on modes
- **Text Chat**: Global chat with player names
- **Admin System**: Password-protected admin panel with invite code generation

## What's New (Improvements)

### Bug Fixes
- ✅ **Mouse Look**: Full pointer lock implementation - click to enable, ESC to release
- ✅ **Player Colors**: Fixed random color generation (was sometimes generating invalid hex)
- ✅ **Name Labels**: Improved canvas rendering with proper sizing and background

### New Features
- ✅ **Central Spawn Point**: Players spawn at the center of the world, above ground
- ✅ **Player List**: Shows all connected players with their colors
- ✅ **Crosshair**: White crosshair in center of screen
- ✅ **Chat Hint**: "Press T to chat" shown below chat box
- ✅ **Fog**: Atmospheric fog that obscures distant terrain
- ✅ **Controls Help**: On-screen key bindings reference

### Performance Improvements
- ✅ **Perlin Noise Terrain**: Smoother, more natural-looking terrain instead of random blocks
- ✅ **Merged Geometry**: All terrain rendered as a single mesh instead of thousands of individual cubes
- ✅ **Face Culling**: Only visible faces are rendered (hidden faces between blocks are skipped)
- ✅ **Colored Layers**: Grass on top, dirt below, stone at bottom

## Project Structure

```
laatta/
├── server.js           # Express + Socket.IO backend
├── package.json        # Dependencies
├── public/             # Static files served to players
│   ├── index.html      # Player join screen + game UI
│   ├── game.js         # Three.js game engine, physics, networking
│   ├── world.js        # Perlin noise terrain generation
│   └── settings.js     # Configuration constants
└── pantry/             # Admin-only files
    └── kitchen.html    # Admin dashboard
```

## Configuration

Edit `public/settings.js` to customize:

```javascript
const CONFIG = {
    WORLD_SIZE: 60,           // World size in blocks
    BLOCK_SIZE: 5,            // Size of each block
    VIEW_DISTANCE: 250,       // Camera far plane
    FOG_NEAR: 100,            // Fog start distance
    FOG_FAR: 250,             // Fog end distance
    TERRAIN_SCALE: 0.08,      // Noise scale (lower = smoother)
    TERRAIN_HEIGHT: 4,        // Max terrain height in blocks
    MOUSE_SENSITIVITY: 0.002, // Mouse look sensitivity
    // ... more options
};
```

## Setup

1. Set the admin password environment variable:
   ```bash
   export ADMIN_PASSWORD=your_secret_password
   ```

2. Install dependencies:
   ```bash
   npm install
   ```

3. Start the server:
   ```bash
   npm start
   ```

4. Access the game:
   - Admin panel: `http://localhost:3000/kitchen`
   - Players join via invite links generated by admin

## Controls

| Key | Action |
|-----|--------|
| W/A/S/D | Move |
| SPACE | Jump |
| Mouse | Look around |
| T | Open chat |
| Enter | Send chat message |
| ESC | Close chat / Release mouse |
| V | Push-to-talk (hold) |

## Deployment

The game is designed to run on platforms like DigitalOcean App Platform:

1. Push code to GitHub
2. Connect repo to DigitalOcean
3. Set `ADMIN_PASSWORD` environment variable
4. Deploy

## Technical Details

- **Frontend**: Three.js (r128), vanilla JavaScript
- **Backend**: Node.js, Express, Socket.IO
- **Voice**: WebRTC with STUN server (stun.l.google.com)
- **World Gen**: Perlin noise with Fractal Brownian Motion (FBM)
